@inject IJSRuntime JSRuntime
@inject Microsoft.Extensions.Localization.IStringLocalizer<App> Localizer

@if (IsVisible)
{
    <div class="level-up-overlay">
        <div class="level-up-content text-center animate-bounce">
            <div class="display-1 mb-3">ðŸŽ‰</div>
            <h1 class="display-3 fw-bold text-warning mb-2">@Localizer["Level Up!"]</h1>
            <h3 class="text-white mb-4">You are now Level @Level!</h3>
            <button class="btn btn-lg btn-light rounded-pill px-5" @onclick="Close">@Localizer["Awesome!"]</button>
        </div>
    </div>
}

<style>
    .level-up-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
    }
    
    .level-up-content {
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @@keyframes popIn {
        0% { opacity: 0; transform: scale(0.5); }
        100% { opacity: 1; transform: scale(1); }
    }
</style>

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public int Level { get; set; }
    [Parameter] public EventCallback<bool> IsVisibleChanged { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        if (IsVisible)
        {
            await JSRuntime.InvokeVoidAsync("fireConfetti");
            // Auto close after 5 seconds if not trusted
            var _ = Task.Delay(5000).ContinueWith(t => 
            {
                if (IsVisible)
                {
                    InvokeAsync(() => Close());
                }
            });
        }
    }

    private async Task Close()
    {
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
        StateHasChanged();
    }
}
