@using System.Globalization
@inject NavigationManager NavigationManager

<div class="language-selector">
    <select class="form-select form-select-sm" @onchange="OnSelected">
        <option value="zh-TW" selected="@(CultureInfo.CurrentCulture.Name == "zh-TW")">繁體中文</option>
        <option value="en" selected="@(CultureInfo.CurrentCulture.Name == "en")">English</option>
        <option value="ja" selected="@(CultureInfo.CurrentCulture.Name == "ja")">日本語</option>
    </select>
</div>

@code {
    private void OnSelected(ChangeEventArgs e)
    {
        var culture = e.Value?.ToString();
        var uri = new Uri(NavigationManager.Uri)
            .GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var query = $"?culture={Uri.EscapeDataString(culture ?? "zh-TW")}&redirectUri={Uri.EscapeDataString(uri)}";

        NavigationManager.NavigateTo("/Culture/Set" + query, forceLoad: true);
    }
}
