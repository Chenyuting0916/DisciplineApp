@page "/"
@using Microsoft.AspNetCore.Components.Web
@namespace DisciplineApp.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="~/" />
    
    <!-- Primary Meta Tags -->
    <title>DisciplineApp - Build Better Habits & Achieve Your Goals</title>
    <meta name="title" content="DisciplineApp - Build Better Habits & Achieve Your Goals" />
    <meta name="description" content="A gamified productivity app to help you build discipline, track tasks, focus with Pomodoro timer, and compete on leaderboards. Start your self-improvement journey today!" />
    <meta name="keywords" content="productivity, discipline, habits, pomodoro timer, task management, gamification, self-improvement, focus, leaderboard" />
    <meta name="author" content="DisciplineApp" />
    <meta name="robots" content="index, follow" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://disciplineapp.azurewebsites.net/" />
    <meta property="og:title" content="DisciplineApp - Build Better Habits & Achieve Your Goals" />
    <meta property="og:description" content="A gamified productivity app to help you build discipline, track tasks, focus with Pomodoro timer, and compete on leaderboards." />
    <meta property="og:image" content="https://disciplineapp.azurewebsites.net/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="DisciplineApp" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:locale:alternate" content="zh_TW" />
    <meta property="og:locale:alternate" content="ja_JP" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://disciplineapp.azurewebsites.net/" />
    <meta name="twitter:title" content="DisciplineApp - Build Better Habits & Achieve Your Goals" />
    <meta name="twitter:description" content="A gamified productivity app to help you build discipline, track tasks, focus with Pomodoro timer, and compete on leaderboards." />
    <meta name="twitter:image" content="https://disciplineapp.azurewebsites.net/og-image.png" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png"/>
    <link rel="apple-touch-icon" href="favicon.png"/>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="css/site.css" rel="stylesheet" />
    <link href="DisciplineApp.styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered" />
</head>
<body>
@using Microsoft.AspNetCore.Authentication

@{
    var accessToken = await HttpContext.GetTokenAsync("access_token");
}

    <component type="typeof(App)" render-mode="ServerPrerendered" param-AccessToken="accessToken" />

    <!-- <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div> -->

    <script src="_framework/blazor.server.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        window.playAudio = (elementId) => {
            var audio = document.getElementById(elementId);
            if (audio) {
                audio.play();
            }
        };

        window.renderChart = (canvasId, config) => {
            var ctx = document.getElementById(canvasId).getContext('2d');
            if (window.myCharts && window.myCharts[canvasId]) {
                window.myCharts[canvasId].destroy();
            }
            if (!window.myCharts) window.myCharts = {};
            window.myCharts[canvasId] = new Chart(ctx, config);
        };
        
        window.fireConfetti = () => {
             var duration = 3 * 1000;
             var animationEnd = Date.now() + duration;
             var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 10000 };

             function random(min, max) {
               return Math.random() * (max - min) + min;
             }

             var interval = setInterval(function() {
               var timeLeft = animationEnd - Date.now();

               if (timeLeft <= 0) {
                 return clearInterval(interval);
               }

               var particleCount = 50 * (timeLeft / duration);
               // since particles fall down, start a bit higher than random
               confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
               confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
             }, 250);
        };
    </script>
</body>
</html>
